"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[879],{3905:function(e,t,o){o.d(t,{Zo:function(){return u},kt:function(){return d}});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function r(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=n.createContext({}),h=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):l(l({},t),e)),o},u=function(e){var t=h(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),p=h(o),d=a,m=p["".concat(s,".").concat(d)]||p[d]||c[d]||i;return o?n.createElement(m,l(l({ref:t},u),{},{components:o})):n.createElement(m,l({ref:t},u))}));function d(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=o.length,l=new Array(i);l[0]=p;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:a,l[1]=r;for(var h=2;h<i;h++)l[h]=o[h];return n.createElement.apply(null,l)}return n.createElement.apply(null,o)}p.displayName="MDXCreateElement"},6017:function(e,t,o){o.r(t),o.d(t,{frontMatter:function(){return r},contentTitle:function(){return s},metadata:function(){return h},toc:function(){return u},default:function(){return p}});var n=o(7462),a=o(3366),i=(o(7294),o(3905)),l=["components"],r={},s=void 0,h={unversionedId:"overview-of-basics-of-VBA/03-11 loop-structures",id:"overview-of-basics-of-VBA/03-11 loop-structures",title:"03-11 loop-structures",description:"loop structures",source:"@site/docs/03-overview-of-basics-of-VBA/03-11 loop-structures.md",sourceDirName:"03-overview-of-basics-of-VBA",slug:"/overview-of-basics-of-VBA/03-11 loop-structures",permalink:"/docs/overview-of-basics-of-VBA/03-11 loop-structures",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-overview-of-basics-of-VBA/03-11 loop-structures.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"03-10 the-Select-Case",permalink:"/docs/overview-of-basics-of-VBA/03-10 the-Select-Case"},next:{title:"03-12 other-control-structures",permalink:"/docs/overview-of-basics-of-VBA/03-12 other-control-structures"}},u=[{value:"loop structures",id:"loop-structures",children:[{value:"For Each loop",id:"for-each-loop",children:[],level:3},{value:"For loop",id:"for-loop",children:[],level:3},{value:"Do/While loop",id:"dowhile-loop",children:[],level:3},{value:"which loop and why",id:"which-loop-and-why",children:[],level:3}],level:2}],c={toc:u};function p(e){var t=e.components,o=(0,a.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"loop-structures"},"loop structures"),(0,i.kt)("p",null,"The loop structures are an integral part of VBA programming. You are pretty much guaranteed to use them immediately. In some cases, you are more likely to use loops than logic structures. The reason that loops are so critical is that they allow you to perform an action multiple times or across multiple objects. Given the nature of a spreadsheet (where you have a high multitude of cells) and the reasons for using VBA (you want to perform some action multiple times) you really can't avoid loops. Gaining an understanding and comfort with loops is critical to your skill with VBA."),(0,i.kt)("p",null,"There are several types of loops that work similarly but have different use cases. Those include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"For Each - useful when you have a collection and want to do something for each object in that collection (this is the most common loop to use since you will nearly always have a collection of Ranges or some other object to iterate through)"),(0,i.kt)("li",{parentName:"ul"},"For - useful when you want to do something a specific number of times"),(0,i.kt)("li",{parentName:"ul"},"Do/While - run a loop until a condition is met which is useful when you do not know in advance how many times to run the loop and you don't have a finite collection")),(0,i.kt)("p",null,"It is worth noting that all loops can be written as a Do/While loop, but you will nearly never do this. There are good reasons that the For Each and For loops exist."),(0,i.kt)("p",null,"It is also worth mentioning here that I typically try to avoid For loops whenever possible. I always prefer to use a For Each loop if it is appropriate for the application. This is not an approach that I used from the beginning but have begun to value the use of For Each loops. If you are coming from a programming language that does not value collection iteration, then you might avoid the For Each loop at first. I'd strongly recommend you learn to use the For Each and appreciate it. Your code will be much cleaner and easier to read with For Each loops instead of the alternatives. Especially when dealing with Ranges, it is tempting to iterate through them as a nested For loop. You should really avoid this."),(0,i.kt)("p",null,"TODO: add an example of a bad For loop"),(0,i.kt)("h3",{id:"for-each-loop"},"For Each loop"),(0,i.kt)("p",null,"It is not traditional to start with the For Each instead of the For loop, but I personally use the For Each far more so I'll start there."),(0,i.kt)("p",null,"The For Each loop is used whenever you have an utterable collection. An utterable collection can come from either the Excel object model or your own code. In general, most of the Excel object model returns an utterable collection. This is especially true for Ranges."),(0,i.kt)("p",null,"TODO: add a list of utterable collections that can be used here"),(0,i.kt)("p",null,"You are not required to put the variable name in the Next line. I recommend not including the variable unless you have tons of code in the loop and are nesting loops. Typically you will rename the variable and then get a compile time error because the variable names don't match. I've never found the variable name in the Next line to help much."),(0,i.kt)("p",null,"TODO: add an example of a For Each loop"),(0,i.kt)("h3",{id:"for-loop"},"For loop"),(0,i.kt)("p",null,'Another style of loop that exists is the "bare" ',(0,i.kt)("inlineCode",{parentName:"p"},"For")," loop. This is one of the simplest loops to understand and control. The idea is simple: iterate through a chunk of code a given number of times. The most common forms of the ",(0,i.kt)("inlineCode",{parentName:"p"},"For")," loop work through a fixed number of iterations. One example is easy: if you want to output the numbers 1 through 10 into a column of cells, you can easily use a For loop to output the number. This is a bad example though since it can easily be done with normal Excel functions, but it is quite common to do the equivalent sort of task when writing a larger macro. In that sense, it is easy to forget how versatile the For loop can be when needing to do something some number of times."),(0,i.kt)("p",null,"Compared to a While loop (discussed below) there are a number of advantages to the For loop:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'Much easier to control the "exit" strategy and avoid infinite loops'),(0,i.kt)("li",{parentName:"ul"},"Can be wired up with constants that are intuitive and just work"),(0,i.kt)("li",{parentName:"ul"},"Can be extended to use variables instead of constants to provide more flexibility")),(0,i.kt)("p",null,"When moving beyond the simple 1 to 10 For loop, there are a handful of options which can be pushed into ever complex strategies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use a variable for either the starting index, increment, or end point"),(0,i.kt)("li",{parentName:"ul"},"Use a negative step to go backwards through a list of numbers"),(0,i.kt)("li",{parentName:"ul"},"Use ",(0,i.kt)("inlineCode",{parentName:"li"},"Exit For")," statements to control execution and kick out of the loop")),(0,i.kt)("p",null,'On that last point is where you will see VBA is woefully underpowered compared to "modern" programming languages. VBA does not provide a simple command to ',(0,i.kt)("inlineCode",{parentName:"p"},"continue")," a loop. There is a ",(0,i.kt)("inlineCode",{parentName:"p"},"Exit For")," which can be used to kick out of the loop, but to ",(0,i.kt)("inlineCode",{parentName:"p"},"continue")," you must create a ",(0,i.kt)("inlineCode",{parentName:"p"},":LABEL")," and use a ",(0,i.kt)("inlineCode",{parentName:"p"},"Goto LABEL")," statement to jump there. There is nothing necessarily wrong with this, but it is an approach that is annoying and prone to some mistakes. The biggest issue is accidentally moving the label or having some other position issue. THe annoyance is having to create a label and use a ",(0,i.kt)("inlineCode",{parentName:"p"},"Goto"),". There is nothing inherently wrong with a ",(0,i.kt)("inlineCode",{parentName:"p"},"Goto")," but they provide create power which means awful bugs later."),(0,i.kt)("p",null,"It is worth noting that the ",(0,i.kt)("inlineCode",{parentName:"p"},"For Each")," loop is a simplification of a ",(0,i.kt)("inlineCode",{parentName:"p"},"For")," loop for a number of instances. In most cases, you could create an index and then iterate through an object by index, storing a reference to the object being stored. Behind the scenes, I believe this is how the majority of internal commands are handled. Despite the 1:1 translation between the two loops, it is typically MUCH simpler to use a ",(0,i.kt)("inlineCode",{parentName:"p"},"For Each")," loop if you just need access to the underlying object in the collection. I will nearly always create an index outside of the loop and use it alongside a ",(0,i.kt)("inlineCode",{parentName:"p"},"For Each")," instead of creating a ",(0,i.kt)("inlineCode",{parentName:"p"},"For")," loop and storing a reference to an object. It always seems vastly simpler to store an Integer than an object. Aside from the marginal advantage of not calling ",(0,i.kt)("inlineCode",{parentName:"p"},"Set"),", there is a immediate payoff of a ",(0,i.kt)("inlineCode",{parentName:"p"},"For Each")," loop that if you name the variables correctly, you can typically read exactly what the code will do. This pays dividends for yourself and others later when reviewing the code."),(0,i.kt)("p",null,"It is also worth mentioning that there are a handful of instances where you are typically required to use a For loop even if you want to use the object being used. The standard example here is if you will eb modified the collection that you are iterating. In this case, you will rapidly create iteration issues trying to modify the collection inside the loop using it. In some of those cases, you will get runtime errors, but in others you will just get unintended consequences. The most common example of doing this is when you want to delete items from a collection while iterating through it. Let's say you need to check whether an item meets some criteria before deleting it. There are two ways to handle this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use a For loop and run thought eh collection BACKWARDS. The direction is critical because it means that at worst, you are working at the end of the list which will not affect future operations."),(0,i.kt)("li",{parentName:"ul"},'Use a "dual loop" approach.')),(0,i.kt)("p",null,"An example of item 1 is shown below."),(0,i.kt)("p",null,"TODO: add example of backward loop"),(0,i.kt)("p",null,"The dual loop approach is worth mentioning further since sometimes it can give you an elegant way out of a bind. The idea is that instead of modifying the collection while you iterate it, you store some amount of information outside of the collection and then use that to determine what to delete. This typically only works if the items being deleted exist independently of the collection that holds them. This happens often enough with Excel that it is worth giving a concrete example: deleting Rows from a Worksheet. To handle this dual loop approach, there are two possible options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use one loop to create a collection that stores the rows to be deleted and then iterate that collection in a new loop"),(0,i.kt)("li",{parentName:"ul"},"Build a larger Range to delete as you go and then use an Excel function to handle the actual deletion")),(0,i.kt)("p",null,'The latter option is only technically a "dual" loop. Technically Excel will use some sort of internal loop to actually delete the Range. You are only required to cleverly create the Range which allows this internal process to be kicked off.'),(0,i.kt)("p",null,"TODO: add an example of the Collection approach for deleting Ranges"),(0,i.kt)("p",null,"TODO: add an example of the UNION-DELETE approach for deleting ranges."),(0,i.kt)("p",null,"TODO: add some examples of For loops and how they might be used"),(0,i.kt)("h3",{id:"dowhile-loop"},"Do/While loop"),(0,i.kt)("p",null,"The final style of loop is the Do/While loop. Although it is mentioned last, it is ultimately the simplest type of loop that exists. The idea is: run until some condition is meeting. This loop matches very nicely when your looping strategy involves some condition. You simply put than tocndifiton int he loop and let it work. The downside to a Do?while loop comes down to the possibility of an infinite loop. This leads to the common problem of a macro that hangs Excel and requires intervention to shut down. Infinite loops are technically easy to avoid, but it is far more common in practice to skip the steps that help avoid infinite loops."),(0,i.kt)("p",null,"It is worth mentioning at this point that all of the loop varieties can be recreated from the other loop varieties. From this standpoint, there are slight advantages to one style over another, but at the end of the day, you simply write the loop that works for the task at hand."),(0,i.kt)("p",null,"For a Do/While loop, there are two possible ways of writing it. You can either do a ",(0,i.kt)("inlineCode",{parentName:"p"},"Do...While")," or a ",(0,i.kt)("inlineCode",{parentName:"p"},"While...Loop"),". THe main difference is whether or not the loop will execute before the condition is checked. There are instances where one style makes more sense over the other. Typically you can always use the ",(0,i.kt)("inlineCode",{parentName:"p"},"While...Loop")," variety, but you may be required to type an initialization statement before the loop that is repeated within the loop."),(0,i.kt)("p",null,"Some common examples where a While loop make sense include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Iterate down through a column of cells until some condition is met (typically a blank or non-blank cell). This is quite helpful when it is difficult to create the ",(0,i.kt)("inlineCode",{parentName:"li"},"Range")," that might be used for a ",(0,i.kt)("inlineCode",{parentName:"li"},"For Each")," loop."),(0,i.kt)("li",{parentName:"ul"},"Iterate through the file system using the ",(0,i.kt)("inlineCode",{parentName:"li"},"Dir")," command to find files to open and process")),(0,i.kt)("p",null,"The WHile loop tends to make the most sense when you are not iterating through a fixed collection of objects because the ",(0,i.kt)("inlineCode",{parentName:"p"},"For Each")," does a better job there. You also would avoid using it when you have a fixed number of iterations to run where a ",(0,i.kt)("inlineCode",{parentName:"p"},"For")," loop makes a lot more sense. That then leaves the instances where you want to loop through some action some number of times, but you're not sure how many times until you start going."),(0,i.kt)("p",null,"If you are particular adventurous, you can make use of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Exit Do")," command to exit out of the loop mid iteration. This pairs nicle with a ",(0,i.kt)("inlineCode",{parentName:"p"},"While True")," at the start of the loop to ensure that nothing else will kick you out of the loop. There are instances where this can be a simple way to loop, but you have to be absolutely certain your ",(0,i.kt)("inlineCode",{parentName:"p"},"Exit Do")," command will be triggered at some ppint or else you guarantee an infinite loop."),(0,i.kt)("p",null,"TODO: add an example of looping use ",(0,i.kt)("inlineCode",{parentName:"p"},"Dir")),(0,i.kt)("p",null,"TODO: add an example of a loop that works through a range using Offset"),(0,i.kt)("h3",{id:"which-loop-and-why"},"which loop and why"),(0,i.kt)("p",null,"There are a handful of common reasons you might go for one loop instead of another. Worth knowing is that in general you can use any of the loops and get the same result. One approach is typically much easier to program, understand, and maintain."),(0,i.kt)("p",null,"A couple of good things to remember:"),(0,i.kt)("p",null,"If you are going to modify a collection in the course of iterating through it, you should not use a For Each loop. The For Each does not update the utterable collection if you modify it during a loop. This is particularly important if you are looping through a collection to identify items to delete from the collection. You should never do this in a For Each loop. When deleting, you should typically use a For loop and iterate through the collection in reverse order. This makes it easy to handle deleting items since you cannot get out of order. You can achieve the same result with a Do/While, but I won't cover that."),(0,i.kt)("p",null,"TODO: add an example of deleting via a For loop"),(0,i.kt)("p",null,"If you need an index/incrementing variable alongside your loop, you are not required to use a For loop. You can always create a new variable and increment it yourself inside the loop. This is sometimes preferable to switching to a For loop solely to get the counter/index variable."),(0,i.kt)("p",null,"If you are using a Do/While loop, you should give serious consideration to adding a counter and breaking the loop if the counter gets too large. It happens far too often where I use a While loop and end up freezing Excel because the loop never terminates. You can sometimes break the code and get Excel to respond, but that does not always work. This is especially important if you are generating code that others will use since they may be less familiar with how to break out of an infinite loop."),(0,i.kt)("p",null,"You may need to break out of a loop. Unfortunately, VBA does not have the normal Break and Continue commands that you might be familiar with from another language. The only way to break out of a loop on the spot is to add a label use a Goto command unless you are able to break out of the Function/Sub completely using Exit. This always feels dirty to me so instead I will typically structure the loop with a Boolean that can detect whether the next iteration should continue. This works for Continue, but it is not a good solution for getting a Break. The only way to do this is via a Goto. Just do it."))}p.isMDXComponent=!0}}]);